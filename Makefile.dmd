RM = rm -f
AR = ar rcu
DC = dmd
DFLAGS = -w -Isrc
GDB = -debug -unittest -g
#GDB = -O -release
LIB = 

VPATH = src:src/compiler/codegen:src/compiler/parser:src/compiler/pretty:src/eval/gc:src/eval/smp:src/eval/vm

COMPILER_OBJS = token.o scanner.o parser.o ast.o parse.o compile.o bytecode.o graph.o print.o
VM_OBJS = alloc.o gc.o memory.o mqueue.o rqueue.o smp.o builtins.o run.o state.o
OTHER_OBJS = main.o

OBJS = $(COMPILER_OBJS) $(VM_OBJS) $(OTHER_OBJS)

TARGET = tvm

all : $(TARGET)

$(TARGET) : $(OBJS) $(LIB)
	$(DC) $^ $(DLDLIBS) -of$@

%.o : %.d
	$(DC) $(DFLAGS) $(GDB) $< -c

clean:
	$(RM) $(TARGET)
	$(RM) $(OBJS)

